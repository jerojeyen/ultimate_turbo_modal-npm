import{Controller as t}from"@hotwired/stimulus";import{Turbo as e}from"@hotwired/turbo-rails";import{enter as o,leave as i}from"el-transition";class d extends t{static targets=["container","content"];static values={advanceUrl:String,allowedClickOutsideSelector:String};connect(){let t=this;this.showUTModal(),this.turboFrame=this.element.closest("turbo-frame"),window.addEventListener("popstate",(function(e){t.#t()&&t.#e()})),window.utmodal=this}disconnect(){window.utmodal=void 0}showUTModal(){o(this.containerTarget),this.#o(),this.advanceUrlValue&&!this.#t()&&(this.#i(),history.pushState({},"",this.advanceUrlValue))}hideUTModal(){if(this.hidingUTModal)return;this.hidingUTModal=!0;let t=new Event("utmodal:closing",{cancelable:!0});this.turboFrame.dispatchEvent(t),t.defaultPrevented||(this.#e(),this.#d(),t=new Event("utmodal:closed",{cancelable:!1}),this.turboFrame.dispatchEvent(t),this.#t()&&history.back())}hide(){this.hideUTModal()}refreshPage(){window.Turbo.visit(window.location.href,{action:"replace"})}submitEnd(t){t.detail.success&&this.hideUTModal()}closeWithKeyboard(t){"Escape"==t.code&&this.hideUTModal()}outsideUTModalClicked(t){let e=this.contentTarget.contains(t.target)||this.contentTarget==t.target,o=null!=t.target.closest(this.allowedClickOutsideSelectorValue);e||o||this.hideUTModal()}#e(){i(this.containerTarget).then((()=>{this.turboFrame.removeAttribute("src"),this.containerTarget.remove(),this.#a()}))}#t(){return"true"==document.body.getAttribute("data-turbo-utmodal-history-advanced")}#i(){return document.body.setAttribute("data-turbo-utmodal-history-advanced","true")}#a(){document.body.removeAttribute("data-turbo-utmodal-history-advanced")}#o(){document.body.style.overflow="hidden"}#d(){document.body.style.overflow="auto"}}function a(t){t.register("utmodal",d),Turbo.StreamActions.utmodal=function(){const t=this.getAttribute("message");"hide"==t&&window.utmodal?.hide(),"close"==t&&window.utmodal?.hide()},document.addEventListener("turbo:frame-missing",(function(t){t.detail.response.redirected&&t.target==document.querySelector("turbo-frame#utmodal")&&(t.preventDefault(),t.detail.visit(t.detail.response))}))}e.StreamActions.utmodal=function(){const t=this.getAttribute("message");"hide"==t&&window.utmodal?.hide(),"close"==t&&window.utmodal?.hide()};export{a as default};
